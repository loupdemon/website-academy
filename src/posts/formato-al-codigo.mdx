---
title: Reforzando un formato de c칩digo com칰n
date: 2019-02-08
author: arthur
tags: [codigo, lenguajes, practica, herramienta]
description: Consejos y pr치cticas para tener un formato de c칩digo com칰n en un equipo de desarollo.
---

Vemos todos los d칤as debates sobre usar " o ', usar ; o no usarlo, usar tabs o espacios para identar el c칩digo...lo peor es que estos debates siempre habr치n, son [guerras santas](http://wiki.c2.com/?HolyWar) 游댥

De hecho es algo estos no son debates de los cuales dices bueno no importa..., estos debates suceder치n porque la mayor칤a de desarrollos o mantenimientos de software implican un equipo. Y cuando hay equipos, siempre hay discrepancias.
Es importante que el equipo (o incluso la organizaci칩n en general) defina un est치ndar com칰n. De lo contrar칤o, tendr치n c칩digo como:

```javascript
// c칩digo real de un sistema legado (adaptado a Javascript)
// contracts-component.js
// ...
// programado por desarrollador 1
getState(contracts) {
    return
            contracts.getMcotoEstado()==3 ? messages.getProperty("suspendedSing"):
            (contracts.getMcotoEstado()==2 ? messages.getProperty("dismissedSing") :
            messages.getProperty("activeSing"));
}

// programado por desarrollador 2
ultimoValorAmpliacion(contract) {
    const services = ctx.get('contractsDatesService');
    const contractDate = services.ultimaAmpliacion(contract);

    if(contractDate==null) {
        return null;
    }else {
    return contractDate.getDfecontValor();
    }
}
```

Podemos ver que ambos desarrolladores usan distintas convenciones, por un lado el desarrollador 1 usa comillas simples (`"` en `getState`) mientras el desarrollador 2 usa con comilla dobles (`'` en el otro m칠todo `ultimoValorAmpliacion`), ademas de un `else` sin identaci칩n. Imaginate estas incosistencias esparcidas por todo el c칩digo fuente. Por eso es importante definir lo m치s antes posible una convenci칩n de c칩digo para el equipo, siguiendo el [principio de uniformidad](http://principles-wiki.net/principles:uniformity_principle).

A칰n as칤 es usual que el equipo rompa estas convenciones, por distintos motivos
(un nuevo desarrollador entra al equipo pero no est치 al tanto de las convenciones o un desarrollador se olvida de una regla de la convenci칩n) por ello es importante en lo posible que estas convenciones sean reforzadas por herramientas.

# Usando un formateador

Hoy en d칤a la mayor칤a de lenguajes de programaci칩n tienen herramientas para dar que noformato a tu c칩digo, usando alg칰na convenci칩n usual pero con capacidades de configurarlo seg칰n sea necesario. Por ejemplo, en Go tenemos `fmt`, en Java `google-java-format`, en Javascript `prettier`...

Si el equipo decide usar comillas simples y no usar punto y comas (si para tu lenguaje es opcional, como en Javascript, entonces para que usarlo no?), si usaramos [prettier](https://prettier.io/) como herramienta para dar formato, podr칤amos indicar esas reglas de formato quiza creando un archivo `.prettierrc` como el siguiente

```json
{
  "semi": false, // no semicolon (punto y coma)
  "singleQuote": true // si comilla simple
}
```

Luego simplemente podremos formatear nuestro c칩digo usando el comando `prettier contracts-component.js`. Cualquier miembro del equipo simplemente repetira este comando, no tendr치 m치s que darle formato m anualmente.

Nota para que todo el equipo use las mismas reglas, es importante que este archivo sea compartido. Es m치s debe estar versionada, usando por supuesto una herramienta de versionamiento (como git). En general, todo debe estar versionado, no solo el c칩digo fuente, sino esquemas de bases de datos, migraciones, scripts de despliegue...[cada vez m치s versionamiento](https://www.martinfowler.com/bliki/MoreVersionControl.html).

Aunque se haya mejorado en gran manera el desarrollo muchas cosas se pueden mejorar.

## Mejorando el flujo de desarrollo

En el mundo del desarrollo, una de las cosas que buscamos es automatizar cosas recurrentes, no solo del negocio, sino tambien de nuestro trabajo de desarrollo. Automatizar la ejecuci칩n de pruebas, el despliegue de nuestras aplicaciones... en nuestro caso podemos automatizar la ejecuci칩n del formateador.

Por ejemplo, podemos instalar un plugin a nuestro IDE o editor para que cada vez que guardemos un archivo le de el formato a nuestro c칩digo.

![dar formato al guardar](https://raw.githubusercontent.com/leftstick/vscode-esformatter/master/docs/img/format.gif)

Si usaramos `vscode`, usando el mismo ejemplo anterior, podr칤amos agregarle un par de configuraciones, para hacer el flujo m치s dulce 游꼻. Por ejemplo, podr칤amos instalar integrarlo con prettier instalando un [plugin](https://marketplace.visualstudio.com/items?itemName=esbenp.prettier-vscode) y luego simplemente poner:

```json
{
  // En el archivo .vscode/settings.json
  "editor.formatOnSave": true
  // ...
}
```

Y cada vez que guardemos un archivo, automaticamente se dar치 formato 游땎.

Sin embargo, muchas veces nuestro editor no posee una integraci칩n al formateador de nuestro gusto o incluso puede que usemos un generador de c칩digo (por ejemplo un CLI de alg칰n framework como Laravel o Angular) que genera un par de clases con el fin de facilitarnos escribir c칩digo, pero que lamentablemente genra c칩digo que no sigue nuestras convenciones. Por estos motivos, muchas veces es recomendable agregar un check antes del commit, muy similar a la t칠cnica de [pre-commit build checks](https://www.thoughtworks.com/radar/techniques/pre-commit-downstream-build-checks), que dar치 formato a nuestro c칩digo antes de dar un commit.

Siguiendo el ejemplo de usar `prettier`, facilmente podr칤amos agregar [husky](https://github.com/typicode/husky) para ello. Agregando a nuestro `package.json` lo siguiente:

```json
{
  "husky": {
    "hooks": {
      "pre-commit": "lint-staged"
    }
  },
  "lint-staged": {
    "*.{js,json,css,md}": ["prettier --write", "git add"]
  }
}
```

Otro punto importante que a menudo veo usar en varios proyectos, es la integraci칩n del formateador con el linter que uses(como SonarQuobe, EsLint), m치s por regla general, evita que tu linter tenga que ver con el estilo de formato de tu c칩digo, [sino que solo ayude a detectar bugs](https://benfrain.com/use-linters-for-errors-formatters-to-fix-style/) y quiza un estilo de programaci칩n (por ejemplo, usar siempre constantes o en lo posible usar operadores ternarios en vez de `if/else`).
